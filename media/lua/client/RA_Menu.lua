--[[⠀
----------------------------------------------------------------------------------------------------------------------------⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀                       ⠀⢀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣀⣀⣀⣀⣀⣰⣦⣀⣀⠀⠠⠄⠄⠠⠀⠀⢀⣠⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣾⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⡿⢿⣦⠀⠀⠀⠀⠀⠀⠀⢀⡷⠀⠀⠀⠀⠀⣀⠀⠀⠀⠀⠀⣩⡿⠋⠙⠉⢩⡿⠟⠀⠀⠀⠀⠀⠀⢀⣶⣾⠟⠋⠛⣿⣷⡄⠀⠀⠀⠀⠀⣴⣿⠂⠀⠀⣼⡿⠀⠀⠀⠀⠀⠀⢀⣠⡴⠶⣤⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⠦⠤⣤⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⡿⠋⠀⢸⠏⠀⠀⠀⠀⠀⠀⠀⣼⠃⠀⠀⠀⠀⢠⡇⠀⠀⠀⢠⣾⠋⠀⠀⠀⠀⣸⠀⠀⠀⠀⠀⠀⠀⢠⣿⠋⠀⠀⠀⠀⠛⠛⠁⠀⠀⠀⢀⣾⣿⠏⠀⠀⢀⡿⠃⠀⠀⠀⠀⠀⠶⠋⠁⢀⣰⠟⠀⠀⠀⠀⠀⠀⠀⣹⣿⠀⠀⠀⠀⣨⣿⠇⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣾⡟⢀⣠⣤⣴⣶⠆⠀⠀⠀⠀⠀⢰⠃⠀⠀⠀⠀⠀⣾⠀⠀⠀⣰⣿⠃⠀⠀⠀⠀⠀⣿⡀⠀⠀⠀⠀⠀⢀⣿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⠋⠀⠀⢀⡾⠁⠀⠀⠀⠀⠀⠀⠀⣠⣶⣯⣅⡀⠀⠀⠀⠀⠀⠀⠀⣿⡇⢀⣠⠴⠞⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣸⡟⠀⠛⠉⣠⣾⠃⠀⠀⠀⠀⠀⠀⣼⠀⠀⠀⠀⠀⠀⢿⣤⡴⢺⢻⠃⠀⠀⠀⠀⠀⢸⡿⠁⠀⠀⠀⠀⠀⠀⢿⠀⠀⠀⠀⢀⣤⠀⠀⠀⠀⠀⢀⣿⣇⡤⠤⢤⣾⣤⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢻⡆⠀⠀⠀⠀⠀⣿⣯⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⣿⠃⠀⠀⢀⣼⠇⠀⠀⠀⠀⠀⠀⣰⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⢂⠇⠀⠀⠀⠀⠀⠀⣾⡅⠀⠀⠀⠀⠀⠀⠀⢸⣧⡀⠀⠀⣼⠇⠀⠀⠀⠀⠀⢸⣿⠀⠀⠀⠐⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠃⠀⠀⠀⠀⠀⢰⡏⠘⣦⠀⠀⠀⠀⡀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠘⢧⣤⡶⠟⢻⠀⠀⠀⠀⠀⠀⢠⡏⠀⠀⠀⠀⠀⠀⠀⠀⠀⢘⠏⠀⠀⠀⠀⠀⠀⢰⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠙⠿⣶⡾⠋⠀⠀⠀⠀⠀⠀⢸⡟⠀⠀⠀⢰⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠞⠁⠀⠀⠀⠀⠀⠀⠁⠀⠈⠙⠂⠔⠊⠁⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣼⠀⠀⠀⠀⠀⢀⣿⣤⠶⠒⠒⠁⠀⠀⠀⠀⢠⠏⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠉⠀⠀⠀⠀⢸⠀⠀⠀⠀⠀⠀⠀⠀⠀⠄⠐⠊⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀

----------------------------------------------------------------------------------------------------------------------------
⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
Please contact me if you need to hire someone to do mods or other design related tasks
https://steamcommunity.com/id/glytch3r/myworkshopfiles/
https://www.glytch3r.com
https://ko-fi.com/glytch3r
Discord: Glytch3r#2892

----------------------------------------------------------------------------------------------------------------------------
--]]

--if not (getCore():getDebug() or isAdmin()) then return; end


ReanimationMenu = ISCollapsableWindow:derive("ReanimationMenu");

ReanimationMenu.cheat = true
ReanimationMenu.instance = nil
local xOrigin = getCore():getScreenWidth() - 518
local yOrigin = getCore():getScreenHeight() - 440
function ReanimationMenu.openPanel(playerObj)
    if ReanimationMenu.instance == nil then
        local window = ReanimationMenu:new(xOrigin, yOrigin, 125 - 12, 270, playerObj)
        window:initialise()
        window:addToUIManager()
    end
    ReanimationMenu.instance = window
end

-- TODO Rework these names to make them consistent
local opTitle1 = "SetUndead"
local opTitle2 = "Scream!"
local opTitle3 = "recovery"
local opTitle4 = "viral"
local opTitle5 = "zedblaze"
local opTitle6 = "zeddeath"
local opTitle7 = "injury"

------------------------------------------------------------------
-- OnClick Functions


-- Set a certain player as a playable zed
local function SetUndead()

    if not getPlayer() then
        return
    end

    local player = getPlayer()
    local inventory = player:getInventory()

    player:clearWornItems()
    inventory:clear()
    player:resetModel()

    local bone_clothing = "Skin.Bones"
    local equipped_bone_clothing = inventory:AddItem(bone_clothing)
    equipped_bone_clothing:getVisual():setTextureChoice(3)
    player:setWornItem(equipped_bone_clothing:getBodyLocation(), equipped_bone_clothing)

    -- TODO what's this?
    if player:getModData()['glytchprint'] then
        player:getModData()['glytchprint'] = nil
    else
        player:getModData()['glytchprint'] = true;
    end

end

-- Generate a zed scream
local function StartScream()
    local player = getPlayer()

    -- TODO this is just for debug I guess, delete it maybe
    player:getBodyDamage():RestoreToFullHealth()
    player:getZombieKills()

end

-- Toggle on or off the healing on a player zed
local function ToogleZombiePlayerHealing()

    if getPlayer():getModData()['undeadheal'] then
        getPlayer():getModData()['undeadheal'] = false
        Events.OnPlayerUpdate.Remove(undeadRecovery)
    else
        getPlayer():getModData()['undeadheal'] = true;
        Events.OnPlayerUpdate.Add(undeadRecovery)
    end


end

------------------------------------------------------------------



function ReanimationMenu:onClick(button)
    -- TODO Finish cleaning this up
    if button.internal == "SetUndead" then
        SetUndead()
    elseif button.internal == "StartScream" then
        StartScream()
    elseif button.internal == "ToogleZombiePlayerHealing" then
        ToogleZombiePlayerHealing()      -- TODO this is a toggle, not really clear in a menu like this
    elseif button.internal == opTitle4 then
        print(opTitle4)
        if getPlayer():getModData()['glytchviral'] then
            getPlayer():getModData()['glytchviral'] = nil
        else
            getPlayer():getModData()['glytchviral'] = true
        end
    elseif button.internal == opTitle5 then
        print(opTitle5 .. ' zedblaze removed')
        --[[
                if getPlayer():getModData()['zedblaze'] then
                    getPlayer():getModData()['zedblaze'] = nil
                else
                    getPlayer():getModData()['zedblaze'] = true
                end ]]
    elseif button.internal == opTitle6 then
        print(opTitle6);
        if getPlayer():getModData()['zeddeath'] then
            getPlayer():getModData()['zeddeath'] = nil
        else
            getPlayer():getModData()['zeddeath'] = true
        end
    elseif button.internal == opTitle7 then
        print(opTitle7)
        glytchinjury()
    end

end

function ReanimationMenu:createChildren()
    ISCollapsableWindow.createChildren(self);

    local th = self:titleBarHeight()
    local buttonWid = 90 - 12
    local buttonHgt = 24

    self.opt1 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, th + 10, buttonWid, buttonHgt, opTitle1, self,
            ReanimationMenu.onClick);
    self.opt1.internal = opTitle1;
    self.opt1:initialise();
    self.opt1:instantiate();
    self:addChild(self.opt1);

    self.opt2 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, self.opt1:getBottom() + 10, buttonWid, buttonHgt,
            opTitle2, self, ReanimationMenu.onClick);
    self.opt2.internal = opTitle2;
    self.opt2:initialise();
    self.opt2:instantiate();
    self:addChild(self.opt2);

    self.opt3 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, self.opt2:getBottom() + 10, buttonWid, buttonHgt,
            opTitle3, self, ReanimationMenu.onClick);
    self.opt3.internal = opTitle3;
    self.opt3:initialise();
    self.opt3:instantiate();
    self:addChild(self.opt3);

    self.opt4 = ISButton:new(self:getWidth() / 2 - buttonWid / 2 + 6, self.opt3:getBottom() + 10, buttonWid - 12,
            buttonHgt, opTitle4, self, ReanimationMenu.onClick);
    self.opt4.internal = opTitle4;
    self.opt4:initialise();
    self.opt4:instantiate();
    self:addChild(self.opt4);

    self.opt5 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, self.opt4:getBottom() + 10, buttonWid, buttonHgt,
            opTitle5, self, ReanimationMenu.onClick);
    self.opt5.internal = opTitle5;
    self.opt5:initialise();
    self.opt5:instantiate();
    self:addChild(self.opt5);

    self.opt6 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, self.opt5:getBottom() + 10, buttonWid, buttonHgt,
            opTitle6, self, ReanimationMenu.onClick);
    self.opt6.internal = opTitle6;
    self.opt6:initialise();
    self.opt6:instantiate();
    self:addChild(self.opt6);

    self.opt7 = ISButton:new(self:getWidth() / 2 - buttonWid / 2, self.opt6:getBottom() + 10, buttonWid, buttonHgt,
            opTitle7, self, ReanimationMenu.onClick);
    self.opt7.internal = opTitle7;
    self.opt7:initialise();
    self.opt7:instantiate();
    self:addChild(self.opt7);
end

function ReanimationMenu:close()
    ReanimationMenu.instance = nil
    self:setVisible(false);
    self:removeFromUIManager()
end

function ReanimationMenu:new(x, y, width, height, character)
    local o = ISCollapsableWindow.new(self, x, y, width, height);
    o:setResizable(true)
    o.title = "Reanimation"
    o.character = character

    return o
end

function ReanimationMenu.press(key)
    if (key == 207) then
        if not (getCore():getDebug() or isAdmin()) then
            return ;
        end
        ReanimationMenu.openPanel()
        return key
    end
    if (key == getCore():getKey("Emote") or key == getCore():getKey("Shout")) then
        if not (getCore():getDebug() or isAdmin()) then
            return ;
        end
        if getPlayer():getModData()['glytchprint'] then
        end


        -- TODO Move this


        getPlayer():playEmote("isZedScream")
        glytchrage()
        return key
    end
end

Events.OnKeyPressed.Add(ReanimationMenu.press);
